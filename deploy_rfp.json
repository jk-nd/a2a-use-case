{
  "package": "rfp_workflow",
  "protocol": "RfpWorkflow",
  "nplCode": "package rfp_workflow\n\n/**\n * Struct to represent an RFP request with budget information\n * @param rfpId Unique identifier for the RFP\n * @param title Title of the RFP\n * @param description Description of the RFP\n * @param requestedAmount Amount requested for the RFP\n * @param requesterId ID of the requesting agent\n * @param createdAt Timestamp when the RFP was created\n */\nstruct RfpRequest {\n    rfpId: Text,\n    title: Text,\n    description: Text,\n    requestedAmount: Number,\n    requesterId: Text,\n    createdAt: DateTime\n};\n\n/**\n * Struct to represent budget approval response\n * @param approved Whether the budget was approved\n * @param approvedAmount Amount approved (may be less than requested)\n * @param reason Reason for approval or rejection\n * @param approverId ID of the approving agent\n * @param approvedAt Timestamp when approval was given\n */\nstruct BudgetApproval {\n    approved: Boolean,\n    approvedAmount: Number,\n    reason: Text,\n    approverId: Text,\n    approvedAt: DateTime\n};\n\n/**\n * RFP Workflow Protocol connecting procurement and finance agents\n * @param procurementAgent The procurement agent party\n * @param financeAgent The finance agent party\n * @param initialRfp The initial RFP request\n */\n@api\nprotocol[procurementAgent, financeAgent] RfpWorkflow(var initialRfp: RfpRequest) {\n    require(initialRfp.requestedAmount > 0, \"Requested amount must be positive\");\n    require(initialRfp.rfpId.length() > 0, \"RFP ID cannot be empty\");\n\n    // States\n    initial state draft;\n    state pendingApproval;\n    state approved;\n    final state rejected;\n    final state active;\n    final state cancelled;\n\n    // Private variables\n    private var rfp = initialRfp;\n    private var budgetApproval: Optional<BudgetApproval> = optionalOf<BudgetApproval>();\n    private var currentBudget = 0;\n\n    /**\n     * Permission for either agent to get RFP details\n     * @return The current RFP request\n     */\n    @api\n    permission[procurementAgent | financeAgent] getRfpDetails() returns RfpRequest | draft, pendingApproval, approved, rejected, active, cancelled {\n        return rfp;\n    };\n\n    /**\n     * Permission for procurement agent to submit RFP for budget approval\n     */\n    @api\n    permission[procurementAgent] submitForApproval() | draft {\n        become pendingApproval;\n    };\n\n    /**\n     * Permission for finance agent to approve the budget\n     * @param approvedAmount Amount approved (may be less than requested)\n     * @param reason Reason for approval\n     */\n    @api\n    permission[financeAgent] approveBudget(approvedAmount: Number, reason: Text) | pendingApproval {\n        require(approvedAmount >= 0, \"Approved amount must be non-negative\");\n        require(reason.length() > 0, \"Reason cannot be empty\");\n\n        var approval = BudgetApproval(\n            approved = true,\n            approvedAmount = approvedAmount,\n            reason = reason,\n            approverId = \"finance-agent\",\n            approvedAt = now()\n        );\n\n        budgetApproval = optionalOf(approval);\n        currentBudget = approvedAmount;\n        become approved;\n    };\n\n    /**\n     * Permission for finance agent to reject the budget\n     * @param reason Reason for rejection\n     */\n    @api\n    permission[financeAgent] rejectBudget(reason: Text) | pendingApproval {\n        require(reason.length() > 0, \"Reason cannot be empty\");\n\n        var approval = BudgetApproval(\n            approved = false,\n            approvedAmount = 0,\n            reason = reason,\n            approverId = \"finance-agent\",\n            approvedAt = now()\n        );\n\n        budgetApproval = optionalOf(approval);\n        become rejected;\n    };\n\n    /**\n     * Permission for procurement agent to activate the RFP after approval\n     */\n    @api\n    permission[procurementAgent] activateRfp() | approved {\n        become active;\n    };\n\n    /**\n     * Permission for procurement agent to cancel the RFP\n     */\n    @api\n    permission[procurementAgent] cancelRfp() | draft, pendingApproval, approved {\n        become cancelled;\n    };\n\n    /**\n     * Permission for finance agent to cancel the RFP\n     */\n    @api\n    permission[financeAgent] cancelRfpByFinance() | pendingApproval {\n        become cancelled;\n    };\n\n    /**\n     * Permission for either agent to get current budget\n     * @return The current available budget amount\n     */\n    @api\n    permission[procurementAgent | financeAgent] getCurrentBudget() returns Number | draft, pendingApproval, approved, rejected, active, cancelled {\n        return currentBudget;\n    };\n\n    /**\n     * Permission for either agent to get budget approval status\n     * @return The budget approval if present\n     */\n    @api\n    permission[procurementAgent | financeAgent] getBudgetApproval() returns Optional<BudgetApproval> | draft, pendingApproval, approved, rejected, active, cancelled {\n        return budgetApproval;\n    };\n} ",
  "token": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJDNFhyZWxjZ1RPa1RCV3B2ZlZtSEFSb3J2eENibGdrUkpuWHJ1eGoyMEdjIn0.eyJleHAiOjE3NTEyMDk1MjgsImlhdCI6MTc1MTIwOTIyOCwianRpIjoib25ydHJvOmU5ZDk4MGVlLTJiY2EtNDkwOC1iZDc1LTkyNzM5YTc2YjFlNSIsImlzcyI6Imh0dHA6Ly9rZXljbG9hazoxMTAwMC9yZWFsbXMvbm91bWVuYSIsInN1YiI6IjA3ZWE1YmNlLTdmNmMtNGVmMi1hOGYwLWFlYjgwMDFkMWYxMCIsInR5cCI6IkJlYXJlciIsImF6cCI6Im5vdW1lbmEiLCJzaWQiOiI1NDYxYmI1NS1iZGY2LTQwNDYtOGFjOC1kNTBjYjMwZjYxMjIiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIioiXSwic2NvcGUiOiJlbWFpbCBwcm9maWxlIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsIm5hbWUiOiJBbGljZSBVc2VyIiwicHJlZmVycmVkX3VzZXJuYW1lIjoiYWxpY2UiLCJnaXZlbl9uYW1lIjoiQWxpY2UiLCJmYW1pbHlfbmFtZSI6IlVzZXIiLCJlbWFpbCI6ImFsaWNlQGV4YW1wbGUuY29tIn0.vxfiMLxxQhy82-JH481jrwi7kcIBU2ADBRtwDXx8vPmeF7mxpTlqxzWbuD0ufqFHCjIAc7-SZVWh4rbPvEq6ASKmGGAD-0R-n1ZyoF1LlddWDVng6vYnkNavg6Q7QOM-wrkNf_xdJW2FxoP9lUTgEflQz33ABIbzpv4r0ivVSKJDIcrlYBG8onO0bqN_fa6Xs3tgBSID6B9OoCyr7EdUs23nAcjrSA4pDeKwAwatFiYOLXk7bzyqn1Z1gip5keGN8YkUra9Eptm_dYnJoN9BbL3Tc8PxjUtKdxPVcDkQPF6nl5GwX5XxB22y6qFLaM0yWZy83ZfTPHtNDsMlDYJhbg"
}
